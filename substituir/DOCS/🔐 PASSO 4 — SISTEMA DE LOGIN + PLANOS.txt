ğŸ” PASSO 4 â€” SISTEMA DE LOGIN + PLANOS (SAAS PROFISSIONAL)

VocÃª vai usar o que o Supabase faz melhor:

Auth

SeguranÃ§a

Controle de acesso

Base para monetizaÃ§Ã£o

Nada reinventado.

ğŸ§© ARQUITETURA GERAL
[Frontend]
   â†“
Supabase Auth (Login / Signup)
   â†“
Tabela profiles (plano, status)
   â†“
Policies (RLS)
   â†“
API / Queries filtradas

âœ… ETAPA 4.1 â€” AUTENTICAÃ‡ÃƒO (SUPABASE AUTH)
1ï¸âƒ£ Ativar Auth

No Supabase:

VÃ¡ em Authentication

Providers:

âœ… Email

(opcional depois: Google)

ConfiguraÃ§Ãµes:

Confirm email: ON

Secure password: ON

2ï¸âƒ£ Fluxos de usuÃ¡rio
ğŸŸ¢ Signup

Email

Senha

ConfirmaÃ§Ã£o por email

ğŸ”µ Login

Email + senha

Retorna user.id (UUID)

Esse user.id serÃ¡ a chave do seu SaaS.

âœ… ETAPA 4.2 â€” TABELA DE PERFIL + PLANOS

Agora vamos ligar usuÃ¡rio â†’ plano.

ğŸ“Œ Criar tabela profiles

No SQL Editor:

CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  email TEXT,
  plano TEXT DEFAULT 'free',
  status TEXT DEFAULT 'ativo',
  criado_em TIMESTAMP DEFAULT now()
);

3ï¸âƒ£ Criar trigger automÃ¡tico (IMPORTANTE)

Toda vez que um usuÃ¡rio se cadastrar, o perfil nasce automaticamente.

CREATE OR REPLACE FUNCTION handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO profiles (id, email)
  VALUES (NEW.id, NEW.email);
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER on_auth_user_created
AFTER INSERT ON auth.users
FOR EACH ROW EXECUTE FUNCTION handle_new_user();


ğŸ‘‰ Isso Ã© padrÃ£o SaaS profissional.

âœ… ETAPA 4.3 â€” DEFINIR PLANOS DO SEU SAAS

Vamos usar planos simples e escalÃ¡veis.

Plano	Acesso
free	3 sugestÃµes/dia
pro	sugestÃµes ilimitadas + simulador
elite	IA avanÃ§ada + alertas
ğŸ“Œ Atualizar plano do usuÃ¡rio

Exemplo:

UPDATE profiles
SET plano = 'pro'
WHERE id = 'USER_UUID';


Isso depois serÃ¡ feito via pagamento.

âœ… ETAPA 4.4 â€” SEGURANÃ‡A (RLS â€“ MUITO IMPORTANTE)

Sem isso, nÃ£o Ã© SaaS.

ğŸ”’ Ativar RLS
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE predictions ENABLE ROW LEVEL SECURITY;

ğŸ” Policy: usuÃ¡rio sÃ³ vÃª o que pode
Profiles
CREATE POLICY "UsuÃ¡rio vÃª seu perfil"
ON profiles
FOR SELECT
USING (auth.uid() = id);

Predictions â€” limitar FREE

Exemplo (FREE sÃ³ vÃª score â‰¥ 80):

CREATE POLICY "Free limitado"
ON predictions
FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND (
      profiles.plano IN ('pro','elite')
      OR score >= 80
    )
  )
);


ğŸ”¥ Isso automaticamente limita o acesso, sem lÃ³gica no front.

âœ… ETAPA 4.5 â€” CONTROLE DE USO (FREE)

Para limitar 3 sugestÃµes/dia, temos duas opÃ§Ãµes:

OPÃ‡ÃƒO PROFISSIONAL (recomendada)

Criar tabela de uso:

CREATE TABLE usage_daily (
  user_id UUID,
  data DATE,
  consultas INT DEFAULT 0,
  PRIMARY KEY (user_id, data)
);


A cada consulta:

incrementa consultas

bloqueia se > 3 (FREE)

Isso pode ser feito:

via Edge Function

ou via API Backend

ğŸ§  O QUE VOCÃŠ GANHOU ATÃ‰ AQUI

âœ… Login profissional
âœ… Controle de planos
âœ… SeguranÃ§a real (RLS)
âœ… Base para cobranÃ§a
âœ… SaaS escalÃ¡vel

VocÃª agora nÃ£o tem mais um projeto, tem um produto.